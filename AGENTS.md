# Flutter Coding Guide (gigme)

Этот файл задает базовые правила для разработки во `flutter_app/`.
Цель: единый стиль, предсказуемая архитектура, минимум регрессий.

## 1. Базовый стек и стиль

- Используй существующий стек проекта: `flutter_riverpod`, `go_router`, `dio`.
- Следуй линтерам из `flutter_app/analysis_options.yaml`:
  - `avoid_print: true`
  - `prefer_single_quotes: true`
  - `sort_constructors_first: true`
- Пиши код читаемо: короткие методы, явные типы там, где это добавляет ясность.
- Не добавляй новые зависимости без необходимости и без согласования.

## 2. Структура кода

- Сохраняй feature-first подход:
  - `lib/features/<feature>/presentation`
  - `lib/features/<feature>/application`
  - `lib/features/<feature>/data`
- Общие вещи держи в:
  - `lib/core` для инфраструктуры, API, моделей, утилит
  - `lib/ui` для дизайн-системы и layout-компонентов
  - `lib/app` для роутинга, темы, bootstrap
- Не смешивай UI и сеть в одном классе: HTTP-логика только в repository/service слое.

## 3. UI/UX правила

- Используй общие UI-примитивы проекта (`AppScaffold`, компоненты из `lib/ui/components`), а не локальные дубли.
- Для цветов/отступов/типографики используй токены темы (`AppColors`, `AppSpacing`, theme), не хардкодь значения без причины.
- Новые экраны должны корректно работать на web и mobile.
- Учитывай `kIsWeb` только там, где действительно есть платформенная разница.

## 4. State management и async

- Управление состоянием делай через Riverpod-провайдеры.
- `setState` допустим для локального UI-состояния виджета, но не для кросс-экранной логики.
- После `await` в `StatefulWidget` проверяй `mounted` перед обновлением UI.
- Обрабатывай ошибки явно: показывай понятные сообщения пользователю, не глоти исключения молча.

## 5. Работа с API и моделями

- Контракты backend не ломать: следуй текущим моделям/DTO и существующим endpoint-паттернам.
- Для JSON используй строгий и предсказуемый маппинг.
- Любое изменение API-контракта должно быть синхронизировано с backend-частью репозитория.

## 6. Роутинг и навигация

- Используй `go_router` и существующую схему маршрутов из `lib/app`.
- Не создавай ad-hoc навигацию в обход общих роутов, если это не временный технический шаг.

## 7. Тесты и проверки

- Для новой логики добавляй тесты там, где это оправдано:
  - unit для чистой бизнес-логики
  - widget для UI-сценариев
- Минимальный чек перед завершением задачи:
  1. `flutter pub get` (если менялись зависимости/ассеты)
  2. `flutter analyze`
  3. `flutter test` (как минимум релевантные тесты)

## 8. Ассеты и конфиги

- Новые ассеты обязательно регистрируй в `flutter_app/pubspec.yaml`.
- Не оставляй неиспользуемые ассеты и мертвые ссылки на удаленные файлы.
- Для env-настроек используй `--dart-define` и существующие ключи из `flutter_app/README.md`.

## 9. Что не делать

- Не использовать `print`; для отладки применяй `debugPrint` или централизованный логгер.
- Не дублировать уже существующие компоненты/стили.
- Не смешивать крупную рефакторинг-работу с фичей без явной необходимости.
- Не оставлять частично рабочее состояние без явной пометки и TODO с контекстом.

## 10. Definition of Done

Задача считается завершенной, если:

1. Код соответствует структуре и правилам выше.
2. Kод откоментирован, подробно , каждая функция.
2. Нет новых предупреждений/ошибок анализатора.
3. Обновлены ассеты/роуты/документация, если это требовалось изменениями.
4. Изменение воспроизводимо локально и не ломает web/mobile сценарии.
